document.addEventListener("DOMContentLoaded",(async()=>{let e,t=0,s=new Map,i=document.getElementById("tile-container"),l=!1,n=!1,d=0;function o(){let e=Math.min(window.innerWidth,window.innerHeight-150)-20;document.documentElement.style.setProperty("--size",e/4.5+"px")}function a(){document.getElementById("score-value").textContent=d}function c(){let e=[];for(let t=1;t<=4;t++)for(let i=1;i<=4;i++){let l=`${t}-${i}`;s.has(l)||e.push({x:t,y:i})}if(0==e.length)l=!0,Swal.fire({title:"Game over!",icon:"error",confirmButtonText:"Try again"}).then((e=>{e.isConfirmed&&window.location.reload()}));else{let l=Math.random()<.9?2:4,n=Math.floor(Math.random()*e.length),{x:d,y:o}=e[n];!function(e,l,n){if(![1,2,3,4].includes(e)||![1,2,3,4].includes(l))return;if(![2,4,8,16,32,64,128,256,512,1024,2048].includes(n))return;if(s.has(`${e}-${l}`))return;t++,s.set(`${e}-${l}`,{value:n,index:t});let d=document.createElement("div");d.id=`tile-${t}`,d.classList.add("tile"),d.classList.add(`tile-${n}`),d.classList.add(`pos-${e}-${l}`),d.classList.add("hidden");let o=document.createElement("p");o.textContent=n,d.appendChild(o),i.appendChild(d),setTimeout((()=>{d.classList.remove("hidden")}),10)}(d,o,l)}}function r(e){if(!l&&!n){switch(n=!0,e){case"left":!function(){for(let e=1;e<=4;e++){let t,i=0,l=0;for(let n=1;n<=4;n++){let o=`${n}-${e}`;if(!s.has(o))continue;let{value:c,index:r}=s.get(o),$=document.getElementById(`tile-${r}`);if(c==i){let u=l,m=t;i=0,$.classList.remove(`pos-${n}-${e}`),$.classList.add(`pos-${u}-${e}`),s.delete(o),setTimeout((()=>{m.parentNode.removeChild(m),s.set(`${u}-${e}`,{value:2*c,index:r}),$.classList.remove(`tile-${c}`),$.classList.add("tile-"+2*c),$.children[0].textContent=2*c,d+=c,a()}),220)}else{let d=l+1;t=$,i=c,l++,$.classList.remove(`pos-${n}-${e}`),$.classList.add(`pos-${d}-${e}`),s.delete(o),s.set(`${d}-${e}`,{value:c,index:r})}}}}();break;case"right":!function(){for(let e=1;e<=4;e++){let t,i=0,l=0;for(let n=4;n>=1;n--){let o=`${n}-${e}`;if(!s.has(o))continue;let{value:c,index:r}=s.get(o),$=document.getElementById(`tile-${r}`);if(c==i){let u=5-l,m=t;i=0,$.classList.remove(`pos-${n}-${e}`),$.classList.add(`pos-${u}-${e}`),s.delete(o),setTimeout((()=>{m.parentNode.removeChild(m),s.set(`${u}-${e}`,{value:2*c,index:r}),$.classList.remove(`tile-${c}`),$.classList.add("tile-"+2*c),$.children[0].textContent=2*c,d+=c,a()}),220)}else{let d=4-l;t=$,i=c,l++,$.classList.remove(`pos-${n}-${e}`),$.classList.add(`pos-${d}-${e}`),s.delete(o),s.set(`${d}-${e}`,{value:c,index:r})}}}}();break;case"up":!function(){for(let e=1;e<=4;e++){let t,i=0,l=0;for(let n=1;n<=4;n++){let o=`${e}-${n}`;if(!s.has(o))continue;let{value:c,index:r}=s.get(o),$=document.getElementById(`tile-${r}`);if(c==i){let u=l,m=t;i=0,$.classList.remove(`pos-${e}-${n}`),$.classList.add(`pos-${e}-${u}`),s.delete(o),setTimeout((()=>{m.parentNode.removeChild(m),s.set(`${e}-${u}`,{value:2*c,index:r}),$.classList.remove(`tile-${c}`),$.classList.add("tile-"+2*c),$.children[0].textContent=2*c,d+=c,a()}),220)}else{let d=l+1;t=$,i=c,l++,$.classList.remove(`pos-${e}-${n}`),$.classList.add(`pos-${e}-${d}`),s.delete(o),s.set(`${e}-${d}`,{value:c,index:r})}}}}();break;case"down":!function(){for(let e=1;e<=4;e++){let t,i=0,l=0;for(let n=4;n>=1;n--){let o=`${e}-${n}`;if(!s.has(o))continue;let{value:c,index:r}=s.get(o),$=document.getElementById(`tile-${r}`);if(c==i){let u=5-l,m=t;i=0,$.classList.remove(`pos-${e}-${n}`),$.classList.add(`pos-${e}-${u}`),s.delete(o),setTimeout((()=>{m.parentNode.removeChild(m),s.set(`${e}-${u}`,{value:2*c,index:r}),$.classList.remove(`tile-${c}`),$.classList.add("tile-"+2*c),$.children[0].textContent=2*c,d+=c,a()}),220)}else{let d=4-l;t=$,i=c,l++,$.classList.remove(`pos-${e}-${n}`),$.classList.add(`pos-${e}-${d}`),s.delete(o),s.set(`${e}-${d}`,{value:c,index:r})}}}}();break}setTimeout((()=>{c(),n=!1}),250)}}o(),window.addEventListener("resize",o),c(),c(),window.addEventListener("keydown",(e=>{if(!l)switch(e.key){case"ArrowLeft":r("left");break;case"ArrowRight":r("right");break;case"ArrowUp":r("up");break;case"ArrowDown":r("down");break}})),window.addEventListener("touchstart",(t=>{l||(e=t.touches[0])})),window.addEventListener("touchend",(t=>{if(l)return;let s=t.changedTouches[0].clientX-e.clientX,i=t.changedTouches[0].clientY-e.clientY;Math.abs(s)<50&&Math.abs(i)<50||(Math.abs(s)>Math.abs(i)?r(s<0?"left":"right"):r(i<0?"up":"down"))}))}));