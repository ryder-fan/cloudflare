document.addEventListener("DOMContentLoaded",(async()=>{let e,t=0,n=new Map,s=document.getElementById("tile-container"),i=!1,l=!1,o=0;function d(e,t,n){var s=new Date;s.setTime(s.getTime()+24*n*60*60*1e3);var i="expires="+s.toGMTString();document.cookie=e+"="+t+";"+i+";path=/"}function a(e){for(var t=e+"=",n=document.cookie.split(";"),s=0;s<n.length;s++){for(var i=n[s];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return null}function r(e){document.cookie=e+"=; Max-Age=-99999999;"}function c(){let e=Math.min(window.innerWidth,window.innerHeight-150)-20;document.documentElement.style.setProperty("--size",e/4.5+"px")}function u(){document.getElementById("score-value").textContent=o}function $(e,i,l){if(![1,2,3,4].includes(e)||![1,2,3,4].includes(i))return;if(![2,4,8,16,32,64,128,256,512,1024,2048].includes(l))return;if(n.has(`${e}-${i}`))return;t++,n.set(`${e}-${i}`,{value:l,index:t});let o=document.createElement("div");o.id=`tile-${t}`,o.classList.add("tile"),o.classList.add(`tile-${l}`),o.classList.add(`pos-${e}-${i}`),o.classList.add("hidden");let d=document.createElement("p");d.textContent=l,o.appendChild(d),s.appendChild(o),setTimeout((()=>{o.classList.remove("hidden")}),10)}function m(){let e=[];for(let t=1;t<=4;t++)for(let s=1;s<=4;s++){let i=`${t}-${s}`;n.has(i)||e.push({x:t,y:s})}if(0==e.length)i=!0,Swal.fire({title:"Game over!",icon:"error",confirmButtonText:"Try again"}).then((e=>{e.isConfirmed&&window.location.reload()}));else{let t=Math.random()<.9?2:4,n=Math.floor(Math.random()*e.length),{x:s,y:i}=e[n];$(s,i,t)}}function f(){let e="";for(let t=1;t<=4;t++)for(let s=1;s<=4;s++){let i=`${t}-${s}`;if(n.has(i)){let{index:l,value:o}=n.get(i);e+=`${t}-${s}-${l}-${o},`}}return e}function h(e){if(i||l)return;l=!0;let t=f();switch(e){case"left":!function(){for(let e=1;e<=4;e++){let t,s=0,i=0;for(let l=1;l<=4;l++){let d=`${l}-${e}`;if(!n.has(d))continue;let{value:a,index:r}=n.get(d),c=document.getElementById(`tile-${r}`);if(a==s){let $=i,m=t;s=0,c.classList.remove(`pos-${l}-${e}`),c.classList.add(`pos-${$}-${e}`),n.delete(d),setTimeout((()=>{m.parentNode.removeChild(m),n.set(`${$}-${e}`,{value:2*a,index:r}),c.classList.remove(`tile-${a}`),c.classList.add("tile-"+2*a),c.children[0].textContent=2*a,o+=a,u()}),220)}else{let o=i+1;t=c,s=a,i++,c.classList.remove(`pos-${l}-${e}`),c.classList.add(`pos-${o}-${e}`),n.delete(d),n.set(`${o}-${e}`,{value:a,index:r})}}}}();break;case"right":!function(){for(let e=1;e<=4;e++){let t,s=0,i=0;for(let l=4;l>=1;l--){let d=`${l}-${e}`;if(!n.has(d))continue;let{value:a,index:r}=n.get(d),c=document.getElementById(`tile-${r}`);if(a==s){let $=5-i,m=t;s=0,c.classList.remove(`pos-${l}-${e}`),c.classList.add(`pos-${$}-${e}`),n.delete(d),setTimeout((()=>{m.parentNode.removeChild(m),n.set(`${$}-${e}`,{value:2*a,index:r}),c.classList.remove(`tile-${a}`),c.classList.add("tile-"+2*a),c.children[0].textContent=2*a,o+=a,u()}),220)}else{let o=4-i;t=c,s=a,i++,c.classList.remove(`pos-${l}-${e}`),c.classList.add(`pos-${o}-${e}`),n.delete(d),n.set(`${o}-${e}`,{value:a,index:r})}}}}();break;case"up":!function(){for(let e=1;e<=4;e++){let t,s=0,i=0;for(let l=1;l<=4;l++){let d=`${e}-${l}`;if(!n.has(d))continue;let{value:a,index:r}=n.get(d),c=document.getElementById(`tile-${r}`);if(a==s){let $=i,m=t;s=0,c.classList.remove(`pos-${e}-${l}`),c.classList.add(`pos-${e}-${$}`),n.delete(d),setTimeout((()=>{m.parentNode.removeChild(m),n.set(`${e}-${$}`,{value:2*a,index:r}),c.classList.remove(`tile-${a}`),c.classList.add("tile-"+2*a),c.children[0].textContent=2*a,o+=a,u()}),220)}else{let o=i+1;t=c,s=a,i++,c.classList.remove(`pos-${e}-${l}`),c.classList.add(`pos-${e}-${o}`),n.delete(d),n.set(`${e}-${o}`,{value:a,index:r})}}}}();break;case"down":!function(){for(let e=1;e<=4;e++){let t,s=0,i=0;for(let l=4;l>=1;l--){let d=`${e}-${l}`;if(!n.has(d))continue;let{value:a,index:r}=n.get(d),c=document.getElementById(`tile-${r}`);if(a==s){let $=5-i,m=t;s=0,c.classList.remove(`pos-${e}-${l}`),c.classList.add(`pos-${e}-${$}`),n.delete(d),setTimeout((()=>{m.parentNode.removeChild(m),n.set(`${e}-${$}`,{value:2*a,index:r}),c.classList.remove(`tile-${a}`),c.classList.add("tile-"+2*a),c.children[0].textContent=2*a,o+=a,u()}),220)}else{let o=4-i;t=c,s=a,i++,c.classList.remove(`pos-${e}-${l}`),c.classList.add(`pos-${e}-${o}`),n.delete(d),n.set(`${e}-${o}`,{value:a,index:r})}}}}();break}setTimeout((()=>{l=!1,f()!=t&&(m(),d("current",f(),3),d("score",o,3))}),250)}if(c(),window.addEventListener("resize",c),a("current")){o=Number(a("score")),u();let e=a("current").split(",");for(let t=0;t<e.length;t++){let[n,s,,i]=e[t].split("-").map(Number);$(n,s,i)}}else m(),m();window.addEventListener("keydown",(e=>{if(!i)switch(e.key){case"ArrowLeft":h("left");break;case"ArrowRight":h("right");break;case"ArrowUp":h("up");break;case"ArrowDown":h("down");break}})),window.addEventListener("touchstart",(t=>{i||(e=t.touches[0])})),window.addEventListener("touchend",(t=>{if(i)return;let n=t.changedTouches[0].clientX-e.clientX,s=t.changedTouches[0].clientY-e.clientY;Math.abs(n)<50&&Math.abs(s)<50||(Math.abs(n)>Math.abs(s)?h(n<0?"left":"right"):h(s<0?"up":"down"))})),document.getElementById("new-game").addEventListener("click",(()=>{r("current"),r("score"),window.location.reload()}))}));