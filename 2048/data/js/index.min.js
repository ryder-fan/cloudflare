document.addEventListener("DOMContentLoaded",(async()=>{let e,t=0,s=new Map,i=document.getElementById("tile-container"),l=!1,n=!1;function d(){let e=Math.min(window.innerWidth,window.innerHeight-150)-20;document.documentElement.style.setProperty("--size",e/4.5+"px")}function o(){let e=[];for(let t=1;t<=4;t++)for(let i=1;i<=4;i++){let l=`${t}-${i}`;s.has(l)||e.push({x:t,y:i})}if(0==e.length)l=!0,Swal.fire({title:"Game over!",icon:"error",confirmButtonText:"Try again"}).then((e=>{e.isConfirmed&&window.location.reload()}));else{let l=Math.random()<.9?2:4,n=Math.floor(Math.random()*e.length),{x:d,y:o}=e[n];!function(e,l,n){if(![1,2,3,4].includes(e)||![1,2,3,4].includes(l))return;if(![2,4,8,16,32,64,128,256,512,1024,2048].includes(n))return;if(s.has(`${e}-${l}`))return;t++,s.set(`${e}-${l}`,{value:n,index:t});let d=document.createElement("div");d.id=`tile-${t}`,d.classList.add("tile"),d.classList.add(`tile-${n}`),d.classList.add(`pos-${e}-${l}`),d.classList.add("hidden");let o=document.createElement("p");o.textContent=n,d.appendChild(o),i.appendChild(d),setTimeout((()=>{d.classList.remove("hidden")}),10)}(d,o,l)}}function a(e){if(!l&&!n){switch(n=!0,e){case"left":!function(){for(let e=1;e<=4;e++){let t,i=0,l=0;for(let n=1;n<=4;n++){let d=`${n}-${e}`;if(!s.has(d))continue;let{value:o,index:a}=s.get(d),r=document.getElementById(`tile-${a}`);if(o==i){let c=l,$=t;i=0,r.classList.remove(`pos-${n}-${e}`),r.classList.add(`pos-${c}-${e}`),s.delete(d),setTimeout((()=>{$.parentNode.removeChild($),s.set(`${c}-${e}`,{value:2*o,index:a}),r.classList.remove(`tile-${o}`),r.classList.add("tile-"+2*o),r.children[0].textContent=2*o}),220)}else{let c=l+1;t=r,i=o,l++,r.classList.remove(`pos-${n}-${e}`),r.classList.add(`pos-${c}-${e}`),s.delete(d),s.set(`${c}-${e}`,{value:o,index:a})}}}}();break;case"right":!function(){for(let e=1;e<=4;e++){let t,i=0,l=0;for(let n=4;n>=1;n--){let d=`${n}-${e}`;if(!s.has(d))continue;let{value:o,index:a}=s.get(d),r=document.getElementById(`tile-${a}`);if(o==i){let c=5-l,$=t;i=0,r.classList.remove(`pos-${n}-${e}`),r.classList.add(`pos-${c}-${e}`),s.delete(d),setTimeout((()=>{$.parentNode.removeChild($),s.set(`${c}-${e}`,{value:2*o,index:a}),r.classList.remove(`tile-${o}`),r.classList.add("tile-"+2*o),r.children[0].textContent=2*o}),220)}else{let c=4-l;t=r,i=o,l++,r.classList.remove(`pos-${n}-${e}`),r.classList.add(`pos-${c}-${e}`),s.delete(d),s.set(`${c}-${e}`,{value:o,index:a})}}}}();break;case"up":!function(){for(let e=1;e<=4;e++){let t,i=0,l=0;for(let n=1;n<=4;n++){let d=`${e}-${n}`;if(!s.has(d))continue;let{value:o,index:a}=s.get(d),r=document.getElementById(`tile-${a}`);if(o==i){let c=l,$=t;i=0,r.classList.remove(`pos-${e}-${n}`),r.classList.add(`pos-${e}-${c}`),s.delete(d),setTimeout((()=>{$.parentNode.removeChild($),s.set(`${e}-${c}`,{value:2*o,index:a}),r.classList.remove(`tile-${o}`),r.classList.add("tile-"+2*o),r.children[0].textContent=2*o}),220)}else{let c=l+1;t=r,i=o,l++,r.classList.remove(`pos-${e}-${n}`),r.classList.add(`pos-${e}-${c}`),s.delete(d),s.set(`${e}-${c}`,{value:o,index:a})}}}}();break;case"down":!function(){for(let e=1;e<=4;e++){let t,i=0,l=0;for(let n=4;n>=1;n--){let d=`${e}-${n}`;if(!s.has(d))continue;let{value:o,index:a}=s.get(d),r=document.getElementById(`tile-${a}`);if(o==i){let c=5-l,$=t;i=0,r.classList.remove(`pos-${e}-${n}`),r.classList.add(`pos-${e}-${c}`),s.delete(d),setTimeout((()=>{$.parentNode.removeChild($),s.set(`${e}-${c}`,{value:2*o,index:a}),r.classList.remove(`tile-${o}`),r.classList.add("tile-"+2*o),r.children[0].textContent=2*o}),220)}else{let c=4-l;t=r,i=o,l++,r.classList.remove(`pos-${e}-${n}`),r.classList.add(`pos-${e}-${c}`),s.delete(d),s.set(`${e}-${c}`,{value:o,index:a})}}}}();break}setTimeout((()=>{o(),n=!1}),250)}}d(),window.addEventListener("resize",d),o(),o(),window.addEventListener("keydown",(e=>{if(!l)switch(e.key){case"ArrowLeft":a("left");break;case"ArrowRight":a("right");break;case"ArrowUp":a("up");break;case"ArrowDown":a("down");break}})),window.addEventListener("touchstart",(t=>{l||(e=t.touches[0])})),window.addEventListener("touchend",(t=>{if(l)return;let s=t.changedTouches[0].clientX-e.clientX,i=t.changedTouches[0].clientY-e.clientY;Math.abs(s)<50&&Math.abs(i)<50||(Math.abs(s)>i?a(s<0?"left":"right"):a(i<0?"up":"down"))}))}));