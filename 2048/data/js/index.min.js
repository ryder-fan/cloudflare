document.addEventListener("DOMContentLoaded",(async()=>{let e,t=0,s=new Map,l=document.getElementById("tile-container"),n=!1,i=!1,o=0;function a(e,t,s){var l=new Date;l.setTime(l.getTime()+24*s*60*60*1e3);var n="expires="+l.toGMTString();document.cookie=e+"="+t+";"+n+";path=/"}function d(e){for(var t=e+"=",s=document.cookie.split(";"),l=0;l<s.length;l++){for(var n=s[l];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return null}function r(){let e=Math.min(window.innerWidth,window.innerHeight-150)-20;document.documentElement.style.setProperty("--size",e/4.5+"px")}function c(){document.getElementById("score-value").textContent=o}function $(e,n,i){if(![1,2,3,4].includes(e)||![1,2,3,4].includes(n))return;if(![2,4,8,16,32,64,128,256,512,1024,2048].includes(i))return;if(s.has(`${e}-${n}`))return;t++,s.set(`${e}-${n}`,{value:i,index:t});let o=document.createElement("div");o.id=`tile-${t}`,o.classList.add("tile"),o.classList.add(`tile-${i}`),o.classList.add(`pos-${e}-${n}`),o.classList.add("hidden");let a=document.createElement("p");a.textContent=i,o.appendChild(a),l.appendChild(o),setTimeout((()=>{o.classList.remove("hidden")}),10)}function u(){let e=[];for(let t=1;t<=4;t++)for(let l=1;l<=4;l++){let n=`${t}-${l}`;s.has(n)||e.push({x:t,y:l})}if(0==e.length)n=!0,Swal.fire({title:"Game over!",icon:"error",confirmButtonText:"Try again"}).then((e=>{e.isConfirmed&&window.location.reload()}));else{let t=Math.random()<.9?2:4,s=Math.floor(Math.random()*e.length),{x:l,y:n}=e[s];$(l,n,t)}}function m(){let e="";for(let t=1;t<=4;t++)for(let l=1;l<=4;l++){let n=`${t}-${l}`;if(s.has(n)){let{index:i,value:o}=s.get(n);e+=`${t}-${l}-${i}-${o},`}}return e}function f(e){if(n||i)return;i=!0;let t=m();switch(e){case"left":!function(){for(let e=1;e<=4;e++){let t,l=0,n=0;for(let i=1;i<=4;i++){let a=`${i}-${e}`;if(!s.has(a))continue;let{value:d,index:r}=s.get(a),$=document.getElementById(`tile-${r}`);if(d==l){let u=n,m=t;l=0,$.classList.remove(`pos-${i}-${e}`),$.classList.add(`pos-${u}-${e}`),s.delete(a),setTimeout((()=>{m.parentNode.removeChild(m),s.set(`${u}-${e}`,{value:2*d,index:r}),$.classList.remove(`tile-${d}`),$.classList.add("tile-"+2*d),$.children[0].textContent=2*d,o+=d,c()}),220)}else{let o=n+1;t=$,l=d,n++,$.classList.remove(`pos-${i}-${e}`),$.classList.add(`pos-${o}-${e}`),s.delete(a),s.set(`${o}-${e}`,{value:d,index:r})}}}}();break;case"right":!function(){for(let e=1;e<=4;e++){let t,l=0,n=0;for(let i=4;i>=1;i--){let a=`${i}-${e}`;if(!s.has(a))continue;let{value:d,index:r}=s.get(a),$=document.getElementById(`tile-${r}`);if(d==l){let u=5-n,m=t;l=0,$.classList.remove(`pos-${i}-${e}`),$.classList.add(`pos-${u}-${e}`),s.delete(a),setTimeout((()=>{m.parentNode.removeChild(m),s.set(`${u}-${e}`,{value:2*d,index:r}),$.classList.remove(`tile-${d}`),$.classList.add("tile-"+2*d),$.children[0].textContent=2*d,o+=d,c()}),220)}else{let o=4-n;t=$,l=d,n++,$.classList.remove(`pos-${i}-${e}`),$.classList.add(`pos-${o}-${e}`),s.delete(a),s.set(`${o}-${e}`,{value:d,index:r})}}}}();break;case"up":!function(){for(let e=1;e<=4;e++){let t,l=0,n=0;for(let i=1;i<=4;i++){let a=`${e}-${i}`;if(!s.has(a))continue;let{value:d,index:r}=s.get(a),$=document.getElementById(`tile-${r}`);if(d==l){let u=n,m=t;l=0,$.classList.remove(`pos-${e}-${i}`),$.classList.add(`pos-${e}-${u}`),s.delete(a),setTimeout((()=>{m.parentNode.removeChild(m),s.set(`${e}-${u}`,{value:2*d,index:r}),$.classList.remove(`tile-${d}`),$.classList.add("tile-"+2*d),$.children[0].textContent=2*d,o+=d,c()}),220)}else{let o=n+1;t=$,l=d,n++,$.classList.remove(`pos-${e}-${i}`),$.classList.add(`pos-${e}-${o}`),s.delete(a),s.set(`${e}-${o}`,{value:d,index:r})}}}}();break;case"down":!function(){for(let e=1;e<=4;e++){let t,l=0,n=0;for(let i=4;i>=1;i--){let a=`${e}-${i}`;if(!s.has(a))continue;let{value:d,index:r}=s.get(a),$=document.getElementById(`tile-${r}`);if(d==l){let u=5-n,m=t;l=0,$.classList.remove(`pos-${e}-${i}`),$.classList.add(`pos-${e}-${u}`),s.delete(a),setTimeout((()=>{m.parentNode.removeChild(m),s.set(`${e}-${u}`,{value:2*d,index:r}),$.classList.remove(`tile-${d}`),$.classList.add("tile-"+2*d),$.children[0].textContent=2*d,o+=d,c()}),220)}else{let o=4-n;t=$,l=d,n++,$.classList.remove(`pos-${e}-${i}`),$.classList.add(`pos-${e}-${o}`),s.delete(a),s.set(`${e}-${o}`,{value:d,index:r})}}}}();break}setTimeout((()=>{i=!1,m()!=t&&(u(),a("current",m(),3),a("score",o,3))}),250)}if(r(),window.addEventListener("resize",r),d("current")){o=Number(d("score")),c();let e=d("current").split(",");for(let t=0;t<e.length;t++){let[s,l,,n]=e[t].split("-").map(Number);$(s,l,n)}}else u(),u();window.addEventListener("keydown",(e=>{if(!n)switch(e.key){case"ArrowLeft":f("left");break;case"ArrowRight":f("right");break;case"ArrowUp":f("up");break;case"ArrowDown":f("down");break}})),window.addEventListener("touchstart",(t=>{n||(e=t.touches[0])})),window.addEventListener("touchend",(t=>{if(n)return;let s=t.changedTouches[0].clientX-e.clientX,l=t.changedTouches[0].clientY-e.clientY;Math.abs(s)<50&&Math.abs(l)<50||(Math.abs(s)>Math.abs(l)?f(s<0?"left":"right"):f(l<0?"up":"down"))}))}));