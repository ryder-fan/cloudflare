document.addEventListener("DOMContentLoaded",(async()=>{let e,t=0,s=new Map,i=document.getElementById("tile-container"),l=!1,n=!1;function d(){let e=Math.min(window.innerWidth,window.innerHeight-150)-20;document.documentElement.style.setProperty("--size",e/4.5+"px")}function a(){let e=[];for(let t=1;t<=4;t++)for(let i=1;i<=4;i++){let l=`${t}-${i}`;s.has(l)||e.push({x:t,y:i})}if(0==e.length)l=!0,Swal.fire({title:"Game over!",icon:"error",confirmButtonText:"Try again"}).then((e=>{e.isConfirmed&&window.location.reload()}));else{let l=Math.random()<.9?2:4,n=Math.floor(Math.random()*e.length),{x:d,y:a}=e[n];!function(e,l,n){if(![1,2,3,4].includes(e)||![1,2,3,4].includes(l))return;if(![2,4,8,16,32,64,128,256,512,1024,2048].includes(n))return;if(s.has(`${e}-${l}`))return;t++,s.set(`${e}-${l}`,{value:n,index:t});let d=document.createElement("div");d.id=`tile-${t}`,d.classList.add("tile"),d.classList.add(`tile-${n}`),d.classList.add(`pos-${e}-${l}`),d.classList.add("hidden");let a=document.createElement("p");a.textContent=n,d.appendChild(a),i.appendChild(d),setTimeout((()=>{d.classList.remove("hidden")}),10)}(d,a,l)}}function o(e){if(!l&&!n){switch(n=!0,e){case"left":!function(){for(let e=1;e<=4;e++){let t,i=0,l=0;for(let n=1;n<=4;n++){let d=`${n}-${e}`;if(!s.has(d))continue;let{value:a,index:o}=s.get(d),r=document.getElementById(`tile-${o}`);if(a==i){let c=l,$=t;i=0,r.classList.remove(`pos-${n}-${e}`),r.classList.add(`pos-${c}-${e}`),s.delete(d),setTimeout((()=>{$.parentNode.removeChild($),s.set(`${c}-${e}`,{value:2*a,index:o}),r.classList.remove(`tile-${a}`),r.classList.add("tile-"+2*a),r.children[0].textContent=2*a}),220)}else{let c=l+1;t=r,i=a,l++,r.classList.remove(`pos-${n}-${e}`),r.classList.add(`pos-${c}-${e}`),s.delete(d),s.set(`${c}-${e}`,{value:a,index:o})}}}}();break;case"right":!function(){for(let e=1;e<=4;e++){let t,i=0,l=0;for(let n=4;n>=1;n--){let d=`${n}-${e}`;if(!s.has(d))continue;let{value:a,index:o}=s.get(d),r=document.getElementById(`tile-${o}`);if(a==i){let c=5-l,$=t;i=0,r.classList.remove(`pos-${n}-${e}`),r.classList.add(`pos-${c}-${e}`),s.delete(d),setTimeout((()=>{$.parentNode.removeChild($),s.set(`${c}-${e}`,{value:2*a,index:o}),r.classList.remove(`tile-${a}`),r.classList.add("tile-"+2*a),r.children[0].textContent=2*a}),220)}else{let c=4-l;t=r,i=a,l++,r.classList.remove(`pos-${n}-${e}`),r.classList.add(`pos-${c}-${e}`),s.delete(d),s.set(`${c}-${e}`,{value:a,index:o})}}}}();break;case"up":!function(){for(let e=1;e<=4;e++){let t,i=0,l=0;for(let n=1;n<=4;n++){let d=`${e}-${n}`;if(!s.has(d))continue;let{value:a,index:o}=s.get(d),r=document.getElementById(`tile-${o}`);if(a==i){let c=l,$=t;i=0,r.classList.remove(`pos-${e}-${n}`),r.classList.add(`pos-${e}-${c}`),s.delete(d),setTimeout((()=>{$.parentNode.removeChild($),s.set(`${e}-${c}`,{value:2*a,index:o}),r.classList.remove(`tile-${a}`),r.classList.add("tile-"+2*a),r.children[0].textContent=2*a}),220)}else{let c=l+1;t=r,i=a,l++,r.classList.remove(`pos-${e}-${n}`),r.classList.add(`pos-${e}-${c}`),s.delete(d),s.set(`${e}-${c}`,{value:a,index:o})}}}}();break;case"down":!function(){for(let e=1;e<=4;e++){let t,i=0,l=0;for(let n=4;n>=1;n--){let d=`${e}-${n}`;if(!s.has(d))continue;let{value:a,index:o}=s.get(d),r=document.getElementById(`tile-${o}`);if(a==i){let c=5-l,$=t;i=0,r.classList.remove(`pos-${e}-${n}`),r.classList.add(`pos-${e}-${c}`),s.delete(d),setTimeout((()=>{$.parentNode.removeChild($),s.set(`${e}-${c}`,{value:2*a,index:o}),r.classList.remove(`tile-${a}`),r.classList.add("tile-"+2*a),r.children[0].textContent=2*a}),220)}else{let c=4-l;t=r,i=a,l++,r.classList.remove(`pos-${e}-${n}`),r.classList.add(`pos-${e}-${c}`),s.delete(d),s.set(`${e}-${c}`,{value:a,index:o})}}}}();break}setTimeout((()=>{a(),n=!1}),250)}}d(),window.addEventListener("resize",d),a(),a(),window.addEventListener("keydown",(e=>{if(!l)switch(e.key){case"ArrowLeft":o("left");break;case"ArrowRight":o("right");break;case"ArrowUp":o("up");break;case"ArrowDown":o("down");break}})),window.addEventListener("touchstart",(t=>{l||(e=t.touches[0])})),window.addEventListener("touchend",(t=>{if(l)return;let s=t.changedTouches[0].clientX-e.clientX,i=t.changedTouches[0].clientY-e.clientY;Swal.fire(`dx: ${s}, dy: ${i}`),Math.abs(s)<50&&Math.abs(i)<50||(Math.abs(s)>Math.abs(i)?o(s<0?"left":"right"):o(i<0?"up":"down"))}))}));