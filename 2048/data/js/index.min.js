document.addEventListener("DOMContentLoaded",(async()=>{let e,t=0,s=new Map,l=document.getElementById("tile-container"),i=!1,n=!1,d=0;function o(){let e=Math.min(window.innerWidth,window.innerHeight-150)-20;document.documentElement.style.setProperty("--size",e/4.5+"px")}function a(){document.getElementById("score-value").textContent=d}function r(){let e=[];for(let t=1;t<=4;t++)for(let l=1;l<=4;l++){let i=`${t}-${l}`;s.has(i)||e.push({x:t,y:l})}if(0==e.length)i=!0,Swal.fire({title:"Game over!",icon:"error",confirmButtonText:"Try again"}).then((e=>{e.isConfirmed&&window.location.reload()}));else{let i=Math.random()<.9?2:4,n=Math.floor(Math.random()*e.length),{x:d,y:o}=e[n];!function(e,i,n){if(![1,2,3,4].includes(e)||![1,2,3,4].includes(i))return;if(![2,4,8,16,32,64,128,256,512,1024,2048].includes(n))return;if(s.has(`${e}-${i}`))return;t++,s.set(`${e}-${i}`,{value:n,index:t});let d=document.createElement("div");d.id=`tile-${t}`,d.classList.add("tile"),d.classList.add(`tile-${n}`),d.classList.add(`pos-${e}-${i}`),d.classList.add("hidden");let o=document.createElement("p");o.textContent=n,d.appendChild(o),l.appendChild(d),setTimeout((()=>{d.classList.remove("hidden")}),10)}(d,o,i)}}function c(){let e="";for(let t=1;t<=4;t++)for(let l=1;l<=4;l++){let i=`${t}-${l}`;if(s.has(i)){let{index:n,value:d}=s.get(i);e+=`${t}-${l}-${n}-${d};`}}return e}function $(e){if(i||n)return;n=!0;let t=c();switch(e){case"left":!function(){for(let e=1;e<=4;e++){let t,l=0,i=0;for(let n=1;n<=4;n++){let o=`${n}-${e}`;if(!s.has(o))continue;let{value:r,index:c}=s.get(o),$=document.getElementById(`tile-${c}`);if(r==l){let u=i,m=t;l=0,$.classList.remove(`pos-${n}-${e}`),$.classList.add(`pos-${u}-${e}`),s.delete(o),setTimeout((()=>{m.parentNode.removeChild(m),s.set(`${u}-${e}`,{value:2*r,index:c}),$.classList.remove(`tile-${r}`),$.classList.add("tile-"+2*r),$.children[0].textContent=2*r,d+=r,a()}),220)}else{let d=i+1;t=$,l=r,i++,$.classList.remove(`pos-${n}-${e}`),$.classList.add(`pos-${d}-${e}`),s.delete(o),s.set(`${d}-${e}`,{value:r,index:c})}}}}();break;case"right":!function(){for(let e=1;e<=4;e++){let t,l=0,i=0;for(let n=4;n>=1;n--){let o=`${n}-${e}`;if(!s.has(o))continue;let{value:r,index:c}=s.get(o),$=document.getElementById(`tile-${c}`);if(r==l){let u=5-i,m=t;l=0,$.classList.remove(`pos-${n}-${e}`),$.classList.add(`pos-${u}-${e}`),s.delete(o),setTimeout((()=>{m.parentNode.removeChild(m),s.set(`${u}-${e}`,{value:2*r,index:c}),$.classList.remove(`tile-${r}`),$.classList.add("tile-"+2*r),$.children[0].textContent=2*r,d+=r,a()}),220)}else{let d=4-i;t=$,l=r,i++,$.classList.remove(`pos-${n}-${e}`),$.classList.add(`pos-${d}-${e}`),s.delete(o),s.set(`${d}-${e}`,{value:r,index:c})}}}}();break;case"up":!function(){for(let e=1;e<=4;e++){let t,l=0,i=0;for(let n=1;n<=4;n++){let o=`${e}-${n}`;if(!s.has(o))continue;let{value:r,index:c}=s.get(o),$=document.getElementById(`tile-${c}`);if(r==l){let u=i,m=t;l=0,$.classList.remove(`pos-${e}-${n}`),$.classList.add(`pos-${e}-${u}`),s.delete(o),setTimeout((()=>{m.parentNode.removeChild(m),s.set(`${e}-${u}`,{value:2*r,index:c}),$.classList.remove(`tile-${r}`),$.classList.add("tile-"+2*r),$.children[0].textContent=2*r,d+=r,a()}),220)}else{let d=i+1;t=$,l=r,i++,$.classList.remove(`pos-${e}-${n}`),$.classList.add(`pos-${e}-${d}`),s.delete(o),s.set(`${e}-${d}`,{value:r,index:c})}}}}();break;case"down":!function(){for(let e=1;e<=4;e++){let t,l=0,i=0;for(let n=4;n>=1;n--){let o=`${e}-${n}`;if(!s.has(o))continue;let{value:r,index:c}=s.get(o),$=document.getElementById(`tile-${c}`);if(r==l){let u=5-i,m=t;l=0,$.classList.remove(`pos-${e}-${n}`),$.classList.add(`pos-${e}-${u}`),s.delete(o),setTimeout((()=>{m.parentNode.removeChild(m),s.set(`${e}-${u}`,{value:2*r,index:c}),$.classList.remove(`tile-${r}`),$.classList.add("tile-"+2*r),$.children[0].textContent=2*r,d+=r,a()}),220)}else{let d=4-i;t=$,l=r,i++,$.classList.remove(`pos-${e}-${n}`),$.classList.add(`pos-${e}-${d}`),s.delete(o),s.set(`${e}-${d}`,{value:r,index:c})}}}}();break}setTimeout((()=>{n=!1,c()!=t&&r()}),250)}o(),window.addEventListener("resize",o),r(),r(),window.addEventListener("keydown",(e=>{if(!i)switch(e.key){case"ArrowLeft":$("left");break;case"ArrowRight":$("right");break;case"ArrowUp":$("up");break;case"ArrowDown":$("down");break}})),window.addEventListener("touchstart",(t=>{i||(e=t.touches[0])})),window.addEventListener("touchend",(t=>{if(i)return;let s=t.changedTouches[0].clientX-e.clientX,l=t.changedTouches[0].clientY-e.clientY;Math.abs(s)<50&&Math.abs(l)<50||(Math.abs(s)>Math.abs(l)?$(s<0?"left":"right"):$(l<0?"up":"down"))}))}));